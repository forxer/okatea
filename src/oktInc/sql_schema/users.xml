<?xml version="1.0" encoding="UTF-8"?>
<database>

	<!-- core_users -->
	<action id="core_users" label="Create table %s" string="{{PREFIX}}core_users">

		<test eq="neq" value="{{PREFIX}}core_users" label="Table %s exists" type="wrn"
		string="{{PREFIX}}core_users">SHOW TABLES LIKE '{{PREFIX}}core_users'</test>

		CREATE TABLE IF NOT EXISTS `{{PREFIX}}core_users` (
			`id` 				SERIAL,
			`group_id` 			BIGINT(20) 		UNSIGNED 	NOT NULL 	DEFAULT 0,
			`civility` 			TINYINT(1) 		UNSIGNED	NOT NULL 	DEFAULT 0,
			`active` 			TINYINT(1) 		UNSIGNED	NOT NULL 	DEFAULT 1,
			`username` 			VARCHAR(255) 				NOT NULL 	DEFAULT '',
			`lastname` 			VARCHAR(255) 				NOT NULL 	DEFAULT '',
			`firstname` 		VARCHAR(255) 				NOT NULL 	DEFAULT '',
			`password` 			VARCHAR(40) 				NOT NULL 	DEFAULT '',
			`salt` 				VARCHAR(12) 							DEFAULT NULL,
			`email` 			VARCHAR(255) 				NOT NULL 	DEFAULT '',
			`timezone` 			VARCHAR(255)				NOT NULL 	DEFAULT '',
			`language` 			VARCHAR(12)				 	NOT NULL 	DEFAULT '',
			`registered` 		INT(10) 		UNSIGNED 	NOT NULL 	DEFAULT 0,
			`registration_ip` 	VARCHAR(39) 				NOT NULL 	DEFAULT '0.0.0.0',
			`last_visit` 		INT(10) 		UNSIGNED 	NOT NULL 	DEFAULT 0,
			`activate_string` 	VARCHAR(80) 							DEFAULT NULL,
			`activate_key` 		VARCHAR(8) 								DEFAULT NULL,

			PRIMARY KEY (`id`),
			KEY `{{PREFIX}}core_users_group_id_idx` (`group_id`),
			KEY `{{PREFIX}}core_users_registered_idx` (`registered`),
			KEY `{{PREFIX}}core_users_username_idx` (`username`(8))
		) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE utf8_bin ;
	</action>

	<action id="change_core_users_name_in_lastname" label="Change field %s" string="{{PREFIX}}core_users.name" process="update">
		<test eq="eq" value="name" label="Field %s does not exists"
		string="{{PREFIX}}core_users.name" type="wrn">
		SHOW COLUMNS FROM `{{PREFIX}}core_users` LIKE 'name'
		</test>
		ALTER TABLE `{{PREFIX}}core_users` CHANGE `name` `lastname` VARCHAR(255) NOT NULL DEFAULT ''
	</action>

	<action id="add_core_users_civility" label="Add field %s" string="{{PREFIX}}core_users.civility" process="update">
		<test eq="neq" value="civility" label="Field %s exists"
		string="{{PREFIX}}core_users.civility" type="wrn">
		SHOW COLUMNS FROM `{{PREFIX}}core_users` LIKE 'civility'
		</test>
		ALTER TABLE `{{PREFIX}}core_users` ADD `civility` TINYINT(1) UNSIGNED NOT NULL DEFAULT 0 AFTER `group_id`
	</action>

	<action id="add_core_users_active" label="Add field %s" string="{{PREFIX}}core_users.active" process="update">
		<test eq="neq" value="active" label="Field %s exists"
		string="{{PREFIX}}core_users.active" type="wrn">
		SHOW COLUMNS FROM `{{PREFIX}}core_users` LIKE 'active'
		</test>
		ALTER TABLE `{{PREFIX}}core_users` ADD `active` TINYINT(1) UNSIGNED NOT NULL DEFAULT 1 AFTER `civility`
	</action>


</database>