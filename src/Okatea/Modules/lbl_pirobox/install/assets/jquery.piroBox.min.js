(function(a){a.fn.piroBox=function(i){i=jQuery.extend({selector:"a[class^='pirobox_gall']",my_speed:null,close_speed:300,bg_alpha:0.5,close_all:".piro_close,.piro_overlay",slideShow:null,slideSpeed:null,t_close:"close",t_play_slideshow:"play slideshow",t_stop_slideshow:"stop slideshow",t_previous:"previous",t_next:"next",t_new_window:"Open image in a new window"},i);(function(){var m=a(document).height(),q=a(jQuery('<div class="piro_overlay"></div>').hide().css({opacity:+i.bg_alpha,height:m+"px"})),
f=a(jQuery('<table class="pirobox_content" cellpadding="0" cellspacing="0"></table>')),k=a(jQuery('<div class="caption"></div>'));m=a(jQuery('<div class="piro_nav"></div>'));var o=a(jQuery('<a href="#close" class="piro_close" title="'+i.t_close+'"></a>')),j=a(jQuery('<a href="#play" class="play" title="'+i.t_play_slideshow+'"></a>')),s=a(jQuery('<a href="#stop" class="stop" title="'+i.t_stop_slideshow+'"></a>')),g=a(jQuery('<a href="#prev" class="piro_prev" title="'+i.t_previous+'"></a>')),h=a(jQuery('<a href="#next" class="piro_next" title="'+
i.t_next+'"></a>'));a("body").append(q).append(f);f.append('<tr><td colspan="3" class="pirobox_up"></td></tr><tr><td class="t_l"></td><td class="t_c"></td><td class="t_r"></td></tr><tr><td class="c_l"></td><td class="c_c"><span><span></span></span><div></div></td><td class="c_r"></td></tr><tr><td class="b_l"></td><td class="b_c"></td><td class="b_r"></td></tr><tr><td colspan="3" class="pirobox_down"></td></tr>');a(".pirobox_up").append(o);a(".pirobox_down").append(m);a(".pirobox_down").append(j);
j.hide();a(".pirobox_down").append(g).append(h);m.append(k);var v=g.width();f.hide();m=a(i.selector);for(var w={},n=0;n<m.length;n++){var z=a(m[n]);w["a."+z.attr("class")]=0}var r=[];for(var t in w)r.push(t);for(n=0;n<r.length;n++){a(r[n]).each(function(b){this.rel=b+1+"&nbsp;of&nbsp;"+a(r[n]).length});a(r[n]+":first").addClass("first");a(r[n]+":last").addClass("last")}a(m).each(function(b){this.rev=b+0});t=a(m).each(function(){});var A=a("body").append('<div id="imgCache" style="display:none"></div').children("#imgCache");
a.each(t,function(b,c){a("<div/>").css({background:"url("+c+")"}).appendTo(A)});var e=a(m);a.fn.fixPNG=function(){return this.each(function(){var b=a(this).css("backgroundImage");if(b.match(/^url\(["']?(.*\.png)["']?\)$/i)){b=RegExp.$1;a(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod="+(a(this).css("backgroundRepeat")=="no-repeat"?"crop":"scale")+", src='"+b+"')"}).each(function(){var c=a(this).css("position");c!="absolute"&&
c!="relative"&&a(this).css("position","relative")})}})};a.browser.msie6=a.browser.msie&&/MSIE 6\.0/i.test(window.navigator.userAgent);if(a.browser.msie6&&!/MSIE 8\.0/i.test(window.navigator.userAgent)){a(".t_l,.t_c,.t_r,.c_l,.c_r,.b_l,.b_c,.b_r,a.piro_next, a.piro_prev,a.piro_prev_out,a.piro_next_out,.c_c,.piro_close,a.play,a.stop").fixPNG();t=a(document).height();q.css("height",t+"px")}if(a.browser.msie)i.close_speed=0;a(window).resize(function(){var b=a(document).height();q.css({visibility:"visible",
height:+b+"px"})});g.add(h).bind("click",function(b){b.preventDefault();b=parseInt(a(e).filter(".item").attr("rev"));b=a(this).is(".piro_prev_out,.piro_prev")?a(e).eq(b-1):a(e).eq(b+1);b.size()||(b=a(this).is(".piro_prev_out,.piro_prev")?a(e).eq(a(e).size()-1):a(e).eq(0));b.click();o.add(k).add(h).add(g).css("visibility","hidden")});a(e).each(function(){var b=a(this);b.unbind();b.bind("click",function(c){c.preventDefault();B(b.attr("href"));c=b.attr("href");var u=b.attr("title"),l=b.attr("rel");u==
""?k.html("<p>"+c+'<em class="number">'+l+"</em><a href="+c+' class="link_to" target="_blank" title="'+i.t_new_window+'"></a></p>'):k.html("<p>"+u+'<em class="number">'+l+"</em><a href="+c+' class="link_to" target="_blank" title="'+i.t_new_window+'"></a></p>');b.is(".last")?a(".number").css("text-decoration","underline"):a(".number").css("text-decoration","none");if(b.is(".first")){g.hide();h.show()}else h.add(g).show();if(b.is(".last")){g.show();h.hide();j.css("width","0")}else j.css("width","40px");
if(b.is(".last")&&b.is(".first")){g.add(h).hide();a(".number").hide();j.remove()}a(e).filter(".item").removeClass("item");b.addClass("item");a(".c_c").removeClass("unique")})});var B=function(b){j.add(s).hide();o.add(k).add(h).add(g).css("visibility","hidden");if(f.is(":visible"))a(".c_c div").children().fadeOut(300,function(){a(".c_c div").children().remove();x(b)});else{a(".c_c div").children().remove();f.show();q.fadeIn(300,function(){x(b)})}},x=function(b){if(!f.is(".loading")){f.addClass("loading");
var c=new Image;c.onerror=function(){var d=a(f).height();f.css({marginTop:parseInt(a(document).scrollTop())-d/1.9});a(".c_c div").append('<p class="err_mess">There seems to be an Error:&nbsp;<a href="#close" class="close_pirobox">Close</a></p>');a(".close_pirobox").bind("click",function(p){p.preventDefault();o.add(q).add(f).add(k).add(h).add(g).hide(0,function(){c.src=""});f.removeClass("loading")})};c.onload=function(){var d=c.height,p=c.width;a(f).height();var y=a(window).height();a(window).width();
a(c).height(d).width(p).hide();a(".c_c div").animate({height:d+"px",width:p+"px"},i.my_speed);var C=d/y*2.3;h_fix=y<d?C:2;f.animate({height:d+40+"px",width:p+40+"px",marginLeft:"-"+(p/2+20)+"px",marginTop:parseInt(a(document).scrollTop())-d/h_fix},i.my_speed,function(){a(".piro_nav,.caption").css({width:p+"px","margin-bottom":"10px"});a(".piro_nav").css("margin-left","-"+p/2+"px");k.height();a(".c_c div").append(c);o.css("display","block");h.add(g).add(o).css("visibility","visible");k.css({visibility:"visible",
display:"block",opacity:"0.8",overflow:"hidden"});f.hover(function(){k.stop().fadeTo(200,0.8)},function(){k.stop().fadeTo(200,0)});a(c).fadeIn(300);f.removeClass("loading");i.slideShow===true?j.add(s).show():j.add(s).hide()})};c.src=b;a("html").bind("keyup",function(d){if(d.keyCode==27){d.preventDefault();if(a(c).is(":visible")||a(".c_c>div>p>a").is(".close_pirobox")){a(e).removeClass("slideshow").removeClass("item");o.add(q).add(f).add(k).add(h).add(g).hide(0,function(){c.src=""});f.removeClass("loading");
clearTimeout(l);a(e).children().removeAttr("class");a(".stop").remove();a(".c_c").append(j);a(".sc_menu").css("display","none");a("ul.sc_menu li a").removeClass("img_active").css("opacity","0.4");h.add(g).show().css({top:"50%"});a(e).children().fadeTo(100,1)}}});a("html").bind("keyup",function(d){if(!a(".item").is(".first"))if(d.keyCode==37){d.preventDefault();if(a(c).is(":visible")){clearTimeout(l);a(e).children().removeAttr("class");a(".stop").remove();a(".c_c").append(j);g.click()}}});a("html").bind("keyup",
function(d){if(!a(".item").is(".last"))if(d.keyCode==39){d.preventDefault();if(a(c).is(":visible")){clearTimeout(l);a(e).children().removeAttr("class");a(".stop").remove();a(".c_c").append(j);h.click()}}});a(window).height();s.bind("click",function(d){d.preventDefault();clearTimeout(l);a(e).removeClass("slideshow");a(".stop").remove();a(".pirobox_down").append(j);h.add(g).css("width",v+"px")});j.bind("click",function(d){d.preventDefault();clearTimeout(l);if(a(c).is(":visible")){a(e).addClass("slideshow");
a(".play").remove();a(".pirobox_down").append(s)}h.add(g).css({width:"0px"});return u()});a(i.close_all).bind("click",function(d){a(e).removeClass("slideshow");clearTimeout(l);if(a(c).is(":visible")){d.preventDefault();o.add(q).add(f).add(k).add(h).add(g).hide(0,function(){c.src=""});f.removeClass("loading");a(e).removeClass("slideshow");h.add(g).css("width",v+"px").hide();a(".stop").remove();a(".pirobox_down").append(j);j.hide()}});if(i.slideShow===true)var u=function(){if(a(e).filter(".item").is(".last")){clearTimeout(l);
a(e).removeClass("slideshow");a(".stop").remove();a(".pirobox_down").append(j);h.add(g).css("width",v+"px")}else if(a(e).is(".slideshow")&&a(c).is(":visible")){clearTimeout(l);h.click()}},l=setInterval(u,i.slideSpeed*1E3)}}})()}})(jQuery);